# 代码审阅时效



## 为什么代码审阅需要快速完成？

- 在谷歌，我们针对一个团队开发者产出的产品一起去进行时速优化，而不是针对一个个体开发者写的代码做的优化。开发者个人的速度是很重要，但是没有整个团队的速度的重要性高。
- 代码审阅速度慢的时候，有些情况就会发生：
  - 整个团队的速度会下降。个体的代码审阅的确不会很快得到回应，得等其他工作做完才会一并提交。然而变更中剩下的新特性和bug修复也会顺带这延后个数天、数周或者数月。
  - 开发者对于代码审阅流程开始抗议，如果一个审阅者每隔几天才做一次回应，但是请求变更在变更列表又十分重要，这种情况反而另开发者十分困惑和沮丧。通常这是审阅者的严格带来的抱怨。如果审阅者要求的重大变动(变动确实能改进代码质量)，开发者每次都能迅速做出回应，那这些抱怨就会随风消失。大多数对于代码审阅流程的抱怨都能通过加快代码流程解决。
  - 代码质量能被影响。审阅进度很慢的时候，压力就会增加，从而允许开发者提交低质量的变更。低速的审阅也不利于代码的整理，重构和现有变更的进一步提升。

## 代码审阅的速度应该怎么权衡？

- 如果手中的任务不是特别的紧，你应该在接到代码审阅任务后做一个快速的代码审阅
- 工作日是最好的时间，这个时间代码审阅请求应该被快速相应(第二天早上第一时间)
- 按照指南上的说法，一个典型的变更需要在同一天有需要的情况下进行多次的审阅



## 时效 VS 干扰

- 有时候，个人速度比团队速度要重要不少。比如沉迷写码的时候，就不要打断自己去做代码审阅了。研究表明被打断后开发者需要花大量的时间才能回到流畅的工作流中去。所以打断自己的开发在团队中的成本比稍微延迟一会做代码审阅要高得多。
- 相反，在代码请求审阅之前，你需要留有一个时间点给自己做缓冲，可以是现有工作完成的时候，吃完饭，开完会，又或者是结束休息后。

## 快速相应

- 谈及代码审阅时效时，响应时间往往是我们最关心的，而不是整个变更审阅并提交的时间。理想状态下整个流程应该是很快的，不过往往是一些个人审阅的回应比整个流程要响应的更加迅速。
- 即使有时候需要花费大量时间完成整个审阅流程，开发者如果对流程中影响较大的情况的慢审阅感到进度受阻时，也需要加快响应速度。
- 太忙没办法完成一个完整的审阅时，你也要给开发者一个快速的回应，告诉他你以后会做这个审阅，也可以向其他有能力去快速响应请求的审阅者求助，或者[提供一些简单的评论](https://google.github.io/eng-practices/review/reviewer/navigate.html)(注意：上面没有一项注释是强调你应该停下手中的开发去做回应，可以在工作中留下一个空出的时间点来做回应)
- 审阅者留下足够的时间在审阅中并确保代码已经审阅过，可以合并(LGTM: looks goods to me,谷歌俚语，已经review过，可以合并)，这很重要，表明审阅的代码已经达到[我们的标准](https://google.github.io/eng-practices/review/reviewer/standard.html).然而，来自开发者个人的询问都应该保持快速相应。



## 跨时区审阅

- 处理不同时区的审阅时，问问作者是不是已经下班了，如果他们已经下班，尝试确保第二天作者上班之前能完成审阅。

## 审阅后的可合并评论

- 为了给代码审阅提速，有几种情况可以支持合并代码，即使他们在变更列表中还没解决完建议修改项，符合下面几项的都可以：
  - 开发者给与审阅者信心，保证能适当的完成所有审阅者提出的评论修改点。
  - 剩下的变更是次要的，不强迫开发者做完所有的修改
- 审阅者应该挑出哪些选项是他们打算做的，否则开发者对于哪些需要完成的修改没有清晰的认识
- 当开发者和审阅者不在同一个时区的时候，可以合并的评论提示尤其需要深思熟虑，不然开发者需要为了一个支持合并的评论而等上个一整天，太浪费时间。



## 巨大变更

- 当开发者做了一个比较大的代码变更审阅请求，你不确保有没有足够的时间去做审阅时，典型的回应应该是让开发者拆分变更，拆成几个小的变更，而不是每次审阅一个很大的变更。虽然给开发者带来额外的工作，但是这通常有助于审阅者做更好的审阅。
- 如果这个变更还是没有办法做拆分，同时你也没时间对整个变更做审阅，这时候最起码对于整个变更设计留下一些评论让开发者去做改进。审阅者的其中一个目的就是解放开发者并且让他们短期内做出一些改进，而不是一味牺牲代码质量。

## 代码审阅无时无刻都在改进代码质量

- 跟着指南走，严格要求代码审阅，你会发现无时无刻代码审阅流程都要加快。开发者需要在如何保证代码质量中学会改进自己的代码，发给审阅者的代码变更都要比一开始的要好，然后不断缩短审阅时间。审阅者也应该学会快速响应，同时不要在审阅流程中添乱。但是也不要为了想象中的速度提高而在代码审阅标准中做出让步，从长远的角度来看，这不会对任何东西增速。



## 紧急事件

- 有些紧急事件，变更必须快速通过整个审查流程，同时也要对质量标准做出让步。不过这种情况需要参考[什么是紧急事件?](https://google.github.io/eng-practices/review/emergencies.html#what)，里面介绍了符合和不符合紧急情况的描述。



## 下一篇： [如何编写代码审阅评论](https://github.com/Trojan0523/Code-Review-Docs/blob/main/Chinese/%E5%A6%82%E4%BD%95%E6%92%B0%E5%86%99%E4%B8%80%E4%B8%AA%E4%BB%A3%E7%A0%81%E5%AE%A1%E9%98%85%E8%AF%84%E8%AE%BA.md)



